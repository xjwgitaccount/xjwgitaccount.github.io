!function(){"use strict";Object.create;Object.create;var e=window.document,t=window.navigator.userAgent,n=location.hostname;function o(t){var n;try{n=new RegExp("(?:^|;\\s*)".concat(t,"\\=([^;]+)(?:;\\s*|$)")).exec(e.cookie)}catch(e){}return n?n[1]:void 0}function i(e,t){t?location.replace(e):location.href=e}var a,r,c,l=t.match(/AliApp\(([^/]+)\/([\d._]+)\)/i),s=t.match(/MicroMessenger/i),u="m",g="wapa",d="wapatest",f=new RegExp("([^.]*?)\\.?((?:".concat(["taobao.net","taobao.com"].join(")|(?:").replace(/\./g,"\\."),"))"),"i"),p=n.match(f)||[],m=(p[2]||"taobao.com").match(/\.?taobao\.net$/)?"taobao.net":"taobao.com",v=(a=m,r=p[1]||u,"taobao.net"===a&&(r=d),r!==u&&r!==g&&r!==d&&(r=u),r),b="login",h=function(){var e="",t=o("_w_tb_nick"),n=o("_nk_")||o("snk"),i=o("sn");return t&&"null"!==t?e=decodeURIComponent(t):n&&"null"!==n?e=unescape(unescape(n).replace(/\\u/g,"%u")):i&&"null"!==i&&(e=decodeURIComponent(i)),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")},y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&o.push("".concat(i,"=").concat(encodeURIComponent(t[i])));var a=e;return a=/\?/.test(e)?"".concat(e,"&").concat(o.join("&")):"".concat(a,"?").concat(o.join("&")),n?"".concat(a,"#").concat(n):a},w=window.navigator.userAgent,O=/.+AliApp\((\w+)\/((?:\d+\.)+\d+)\)/.exec(w||"")||[],x=String(O[1]||"").toLowerCase(),S={xianyu:["fm"],cainiao:["cn"],taobao:["tb","tm"],jiaoyi_mao:["jym"],litetao:["lt","lt-lite"]},L={xianyu:{loginPrefix:"passport",bizDomainPrefix:"h5",bizSubDomain:"m",mainDomain:"goofish.com"},litetao:{loginPrefix:"passport",bizDomainPrefix:"pages",bizSubDomain:"",mainDomain:"ltao.com"}};!function(e){e.Login="login",e.Logout="logout",e.Oauth="oauth"}(c||(c={}));var E,C,j=function(e){var t=L[e];return t||console.warn("[lib-login] site:".concat(e," config is not defined, use lib.login.setSiteDomainConfig to set config")),t},N=function(e){var t=j(e);return"".concat(t.bizDomainPrefix,".").concat((null==t?void 0:t.bizSubDomain)?"".concat(t.bizSubDomain,"."):"").concat((null==t?void 0:t.mainDomain)||"")},U=function(e,t){e&&t&&(L[e]=t)},P={xianyu:{api:"mtop.idle.user.simple",v:"1.0",data:{},ecode:1,sessionOption:"AutoLoginOnly",jsonpIncPrefix:"liblogin",dataType:"json"},taobao:{api:"mtop.user.getUserSimple",v:"1.0",data:{},ecode:1,sessionOption:"AutoLoginOnly",jsonpIncPrefix:"liblogin"}},A=function(e,t){return t?t===e:!!x&&(S[e]||[]).some((function(e){return e&&x.indexOf(e)>-1}))},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"taobao",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"m";if("taobao"===e)return"https://".concat(b,".").concat(t,".").concat(m);var n=j(e);return"https://".concat((null==n?void 0:n.loginPrefix)||"",".").concat((null==n?void 0:n.mainDomain)||"")},k=function(e){var t=e.site,n=void 0===t?"taobao":t,o=e.type,i=void 0===o?c.Login:o,a=e.originLoginPath,r=void 0===a?"login.htm":a,l=e.originLogoutPath,s=void 0===l?"logout.htm":l;return"taobao"===n?i===c.Logout?"/".concat(s):"/".concat(r):i===c.Logout?"/".concat(s):"login.htm"!==r?"/".concat(r):"/mini_".concat(r)},F=function(e){var t=e.isFrame,n=void 0!==t&&t,o=e.site,i=void 0===o?"taobao":o,a=e.type,r=void 0===a?c.Login:a,l=e.redirectUrl,s=e.customParams,u=void 0===s?{}:s,g=l||location.href,d={taobao:Object.assign({ttid:n?"h5@iframe":"",redirectURL:g},u),siteLoginParams:Object.assign({ttid:n?"h5@iframe":"",redirectType:n?"iframeRedirect":"Redirect",returnUrl:g,appName:i,appEntrance:"web",isMobile:"true"},u),siteLogoutParams:Object.assign({toUrl:g},u)};return"taobao"===i?d.taobao:r===c.Login?d.siteLoginParams:d.siteLogoutParams},T=location,D=T.hostname,W=T.protocol,R=function(){var e="tmall.com";return D===e||D.endsWith(".".concat(e))};function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,H(o.key),o)}}function z(e,t,n){return(t=H(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e){var t=function(e,t){if("object"!==I(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==I(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===I(t)?t:String(t)}var M,Y=window,J=Y.document,q=Y.dpr||1;function B(e){return e.preventDefault(),!1}!function(e){e.widgetFrame="widgetFrame",e.widgetTitle="widgetTitle",e.iframe="iframe",e.widgetClose="widgetClose"}(M||(M={}));var Z=(z(E={},M.widgetFrame,{"-webkit-transform":"scale(".concat(q,") translateZ(0)"),"-ms-transform":"scale(".concat(q,") translateZ(0)"),transform:"scale(".concat(q,") translateZ(0)"),"-webkit-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0","z-index":"999999",position:"fixed",left:"0",top:"0",right:"0",bottom:"0",background:"#FFF",display:"none"}),z(E,M.widgetTitle,{width:"100%",height:"".concat(52,"px"),background:"#EEE","line-height":"".concat(52,"px"),"text-align":"left","box-sizing":"border-box","padding-left":"".concat(20,"px"),position:"absolute",left:"0",top:"0","font-size":"".concat(16,"px"),"font-weight":"bold",color:"#333"}),z(E,M.iframe,{width:"100%",height:"".concat(window.innerHeight/q,"px"),border:"0",overflow:"hidden"}),z(E,M.widgetClose,{display:"block",position:"absolute",right:"0",top:"0",height:"52px","line-height":"52px",padding:"0 20px",color:"#999"}),E),X=(z(C={},M.widgetFrame,{background:"rgba(90,90,90,0.3)",position:"fixed"}),z(C,M.widgetTitle,{top:"calc(40vh - 52px)","padding-left":0,"box-shadow":"0px -2px 1px 0 rgb(180 180 180 / 20%)","border-radius":"12px 12px 0 0","background-color":"#fff","text-align":"center"}),z(C,M.iframe,{height:"60vh","margin-top":"40vh","background-color":"#fff"}),z(C,M.widgetClose,{"box-sizing":"content-box",width:"15px",height:"15px",padding:"18px 20px"}),C),$=function(e,t){var n=Z[e];if(!n)return"";t&&(n=Object.assign({},n,X[e]||{}));var o=[];for(var i in n)Object.hasOwnProperty.call(n,i)&&o.push("".concat(i,":").concat(n[i]));return o.join(";")},K=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{useSemiLayer:!1};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.text=(null==o?void 0:o.title)||"\u60a8\u9700\u8981\u767b\u5f55\u624d\u80fd\u7ee7\u7eed\u8bbf\u95ee",this.url=n,this.widgetFrame=document.createElement("div"),this.rect=document.documentElement.getBoundingClientRect();var i=null==o?void 0:o.useSemiLayer;this.widgetFrame.style.cssText=$(M.widgetFrame,i);var a=document.createElement("div");a.style.cssText=$(M.widgetTitle,i),a.innerText=this.text;var r=null;i?((r=document.createElement("img")).src="//gw.alicdn.com/imgextra/i2/O1CN01KQFA4M287q502xH3X_!!6000000007886-2-tps-52-54.png",this.url="".concat(this.url).concat(this.url.indexOf("?")?"&":"?","isSemiLayer=true")):(r=document.createElement("a")).innerText="\u5173\u95ed",r.style.cssText=$(M.widgetClose,i);var c=document.createElement("iframe");c.style.cssText=$(M.iframe,i),a.appendChild(r),this.widgetFrame.appendChild(a),this.widgetFrame.appendChild(c),J.body.appendChild(this.widgetFrame),c.src=this.url,r.addEventListener("click",(function(){t.hide();var e=J.createEvent("HTMLEvents");e.initEvent("close",!1,!1),t.widgetFrame.dispatchEvent(e)}),!1)}var t,n,o;return t=e,n=[{key:"show",value:function(){document.addEventListener("touchmove",B,!1),this.widgetFrame.style.display="block",window.scrollTo(0,0)}},{key:"hide",value:function(){document.removeEventListener("touchmove",B),window.scrollTo(0,-this.rect.top),J.body.removeChild(this.widgetFrame)}},{key:"addEventListener",value:function(e,t,n){this.widgetFrame.addEventListener(e,t,n)}},{key:"removeEventListener",value:function(e,t,n){this.widgetFrame.removeEventListener(e,t,n)}}],n&&V(t.prototype,n),o&&V(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}!function(e,t,n){var o=e.Promise;t.login=t.login||{};var a={loginName:"login.htm",logoutName:"logout.htm",subDomain:v,forceNative:!0,disableWidgetLogin:!1,site:"",clientSite:"",enableWOAOauth:!1,oauthName:"oauth_sign.htm"};function r(n,o,i){var a=function(e,t){var n=encodeURIComponent("".concat(W,"//").concat(D));if("taobao"===t.site)return R()?"https://main.m.tmall.com/app/vip/h5-webapp/lib-login-message.html?origin=".concat(n):"https://h5.m.taobao.com/other/".concat(e,"end.html?origin=").concat(n);var o=N(t.site)||"market.m.taobao.com";return"https://".concat(o,"/app/vip/h5-webapp/lib-login-message.html?origin=").concat(n)}(n,o),r=t.login.generateUrl(n,Object.assign({redirectUrl:a,iframe:!0},o)),c=new K(r,Object.assign(Object.assign({},t.login.config.widgetConfig),{title:o.title}));function l(){c.removeEventListener("close",l),e.removeEventListener("message",s),i("CANCEL")}function s(t){var n=t.data||{};if(n&&n.type&&"child"===n.type)return n.content&&n.content.indexOf("SUCCESS")>-1?(c.removeEventListener("close",l),e.removeEventListener("message",s),c.hide(),void i("SUCCESS")):void i("FAILURE")}c.addEventListener("close",l,!1),e.addEventListener("message",s,!1),c.show()}function u(n,o,a){var r=t.login.generateUrl(n,o);if(!e||!e.WindVane||!e.WindVane.isAvailable)return console.warn("WINDVANE_NOT_FOUND::\u7f3a\u5c11WindVane\u73af\u5883"),void i(r,o.replace);e.WindVane.call("aluUccJSBridge","uccTrustLogin",{site:o.site,scene:o.scene},(function(e){if((null==e?void 0:e.ret)&&e.ret.indexOf("HY_SUCCESS")>-1)return a?void a("SUCCESS"):void i(o.redirectUrl||location.href,o.replace);a?a("FAILURE",JSON.stringify(e)):console.warn("[lib-login] FAILURE with ".concat(JSON.stringify(e)))}),(function(e){(null==e?void 0:e.ret)&&e.ret.indexOf("HY_NO_HANDLER")>-1?i(r,o.replace):a&&a("FAILURE",JSON.stringify(e))}))}function g(n,o,a){var g;"function"==typeof o?(a=o,o=null):"string"==typeof o?o={redirectUrl:o}:"object"===Q(o)&&o.url&&(o.redirectUrl=o.url),o=o||{};var d=(null===(g=null==t?void 0:t.login)||void 0===g?void 0:g.config)||{},f=d.site||"taobao",p=d.scene||"",m=d.clientSite||"",v=d.disbleWidgetLogin||d.disableWidgetLogin;if(s&&d.enableWOAOauth){i(t.login.generateWOAOauthUrl({site:f}))}else{var b=t.login.generateUrl(n,Object.assign({site:f},o));if(l)return a&&o.forceNative&&A(f,m)?void function(n,o,a){e&&e.WindVane&&e.WindVane.isAvailable||console.warn("WINDVANE_NOT_FOUND::\u7f3a\u5c11WindVane\u73af\u5883"),e.WindVane.call("aluWVJSBridge","sdkLogin",o,(function(){a("SUCCESS")}),(function(e){var r=e&&e.ret;r&&"HY_FAILED"===r?a("CANCEL"):r&&r.indexOf("HY_")>-1?i(t.login.generateUrl(n,o),o.replace):a("CANCEL")}))}(n,Object.assign({},o),a):A(f,m)||"taobao"===f?e.WindVane&&e.WindVane.isAvailable?void e.WindVane.call("MtopWVPlugin","isSupportAccountSite",{accountSite:f},(function(){A(f,m)?i(b,o.replace):u(n,Object.assign({site:f,scene:p},o),a)}),(function(){i(t.login.generateUrl(n,Object.assign({site:"taobao"},o)),o.replace)})):void i(b,o.replace):void u(n,Object.assign({site:f,scene:p},o),a);!a||n!==c.Login||v?i(b,o.replace):r(n,Object.assign({site:f},o),a)}}function d(e,t,n){var i;if(o&&((i={}).promise=new o((function(e,t){i.resolve=e,i.reject=t}))),g(e,t,(function(e){"function"==typeof n&&n(e),"SUCCESS"===e?i&&i.resolve(e):i&&i.reject(e)})),i)return i.promise}t.login.config=a,t.login.isLogin=function(e){var o,i=(null===(o=null==t?void 0:t.login)||void 0===o?void 0:o.config)||{};if(e&&"function"==typeof e&&t.mtop){var a=P.taobao,r=i.site;r&&P[r]&&(a=P[r]);var c=i.loginCheckMtopConf;return c&&c.api&&c.v&&(a=c),t.mtop.request(a,(function(o){o.retType===t.mtop.RESPONSE_TYPE.SUCCESS?e(!0,o):o.retType===t.mtop.RESPONSE_TYPE.SESSION_EXPIRED?e(!1,o):e(n,o)})),null}return!!this.getUserNick()},t.login.isLoginAsync=function(e){var t;if(o&&((t={}).promise=new o((function(e,n){t.resolve=e,t.reject=n}))),this.isLogin((function(n,o){e&&e(n,o),!0===n?t&&t.resolve(o):t&&t.reject(o)})),t)return t.promise},t.login.getUserNick=function(e){return e&&"function"==typeof e?(this.isLogin((function(t,o){var i,a,r=(null===(i=null==o?void 0:o.data)||void 0===i?void 0:i.displayNick)||(null===(a=null==o?void 0:o.data)||void 0===a?void 0:a.nick);e(!0===t&&r?r:!1===t?"":n)})),null):h()},t.login.getUserNickAsync=function(e){var t;if(o&&((t={}).promise=new o((function(e,n){t.resolve=e,t.reject=n}))),this.getUserNick((function(n){"function"==typeof e&&e(n),n?t&&t.resolve(n):t&&t.reject()})),t)return t.promise},t.login.generateUrl=function(e,n){var o=t.login.config,i=o.subDomain,a=o.loginName,r=void 0===a?"login.htm":a,c=o.logoutName,l=void 0===c?"logout.htm":c,s=_(n.site||"taobao",i),u=k({site:n.site||"taobao",originLoginPath:r,originLogoutPath:l,type:e}),g=F({site:n.site,isFrame:!!n.iframe,redirectUrl:n.redirectUrl,type:e,customParams:t.login.config.loginUrlParams||{}});return y("".concat(s).concat(u),g)},t.login.generateWOAOauthUrl=function(e){var n=e.site,o=t.login.config,i=o.subDomain,a=o.oauthName,r=void 0===a?"oauth_sign.htm":a,c=o.WOAOauthConfig,l=void 0===c?{}:c,s=l.appid,u=l.appName,g=l.appEntrance,d=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(l,["appid","appName","appEntrance"]),f=_(n||"taobao",i),p=Object.assign({appName:u||"taobao",appEntrance:g||"wechat_h5",type:"weixin_official_accounts",responseAction:"redirect",mobile:!0,lang:"zh_CN",connect_redirect:1,return_url:location.href},d),m=y("".concat(f,"/").concat(r),p);return y("https://open.weixin.qq.com/connect/oauth2/authorize",{appid:s||"wx5eff1fd0bfa1bb53",scope:"snsapi_userinfo",response_type:"code",redirect_uri:m,connect_redirect:1},"wechat_redirect")},t.login.goLogin=function(e){g(c.Login,e,null)},t.login.goLoginAsync=function(e,n){return"boolean"==typeof e&&(n=e,e=null),void 0===n&&(n=t.login.config.forceNative),d(c.Login,{forceNative:n},e)},t.login.goLogout=function(e){g(c.Logout,e,null)},t.login.goLogoutAsync=function(e,t){return"boolean"==typeof e&&(t=e,e=null),d(c.Logout,{forceNative:t},e)},t.login.setSiteDomainConfig=U}(window,window.lib||(window.lib={}));window.lib.login}();